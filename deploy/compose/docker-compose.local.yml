# docker-compose.local.yml
services:
  # Keep api defined so depends_on stays valid, but don't run the real API
  api:
    image: busybox
    command: ["sh", "-c", "echo 'API disabled in local mode'; sleep infinity"]
    ports: []
    healthcheck:
      test: ["CMD-SHELL", "exit 0"]
      interval: 5s
      timeout: 2s
      retries: 1

  nginx:
    volumes:
      - ./infra/nginx.local.conf:/etc/nginx/nginx.conf:ro
      - ./infra/.htpasswd:/etc/nginx/.htpasswd:ro
    # CRITICAL: override base depends_on so nginx doesn't require api:service_healthy
    depends_on: {}

  prometheus:
    volumes:
      - ./infra/prometheus.local.yml:/etc/prometheus/prometheus.yml:ro
    ports:
      - "9090:9090"
    depends_on: {}   # you already did this

  postgres:
    ports:
      - "5433:5432"

  redis:
    ports:
      - "6379:6379"

  pgadmin:
    ports:
      - "5050:80"

  grafana:
    ports:
      - "3000:3000"