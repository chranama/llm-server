# Dockerfile.api
FROM python:3.13-slim

# System deps
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential curl wget && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy project metadata + source code
COPY pyproject.toml ./
COPY src ./src

# Install the project (and its dependencies) as a package
# Assumes pyproject.toml is configured with [project] and build-system.
RUN pip install --no-cache-dir .

# Copy runtime extras (DB migrations, Alembic config, etc.)
COPY migrations ./migrations
COPY alembic.ini ./alembic.ini

# Expose internal API port
EXPOSE 8000

# Run the app
# Assumes your main entrypoint is in src/llm_server/main.py
CMD ["serve"]